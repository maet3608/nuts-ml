

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Reading data samples &mdash; nutsml 1.0.46 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Splitting and stratifying" href="split_stratify.html" />
    <link rel="prev" title="Tutorial" href="introduction.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> nutsml
          

          
          </a>

          
            
            
              <div class="version">
                1.0.46
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="introduction.html">Tutorial</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Reading data samples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#basics">Basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#txt-files">TXT files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#csv-files">CSV files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#numpy-arrays">NumPy arrays</a></li>
<li class="toctree-l3"><a class="reference internal" href="#web-files">Web files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#label-directories">Label directories</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="split_stratify.html">Splitting and stratifying</a></li>
<li class="toctree-l2"><a class="reference internal" href="loading_images.html">Loading images</a></li>
<li class="toctree-l2"><a class="reference internal" href="view_images.html">Viewing Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="transform_images.html">Transforming images</a></li>
<li class="toctree-l2"><a class="reference internal" href="augment_images.html">Augmenting images</a></li>
<li class="toctree-l2"><a class="reference internal" href="batching.html">Building Batches</a></li>
<li class="toctree-l2"><a class="reference internal" href="network.html">Training networks</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html">Logging data</a></li>
<li class="toctree-l2"><a class="reference internal" href="plotting.html">Plotting data</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html">Configuration files</a></li>
<li class="toctree-l2"><a class="reference internal" href="cifar10_example.html">CIFAR-10 Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributions.html">Contributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nutsml.html">nutsml package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">nutsml</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="introduction.html">Tutorial</a> &raquo;</li>
        
      <li>Reading data samples</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorial/reading_samples.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="reading-data-samples">
<span id="reader"></span><h1>Reading data samples<a class="headerlink" href="#reading-data-samples" title="Permalink to this headline">¶</a></h1>
<p><strong>nuts-ml</strong> does not have a specific type for data samples
but most functions operate on <code class="docutils literal notranslate"><span class="pre">tuples</span></code>, <code class="docutils literal notranslate"><span class="pre">lists</span></code> or <code class="docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">arrays</span></code>,
with a preference for tuples. For instance, a sample of the <a class="reference external" href="https://en.wikipedia.org/wiki/Iris_flower_data_set#Data_set">Iris data set</a> could be
represented as the tuple <code class="docutils literal notranslate"><span class="pre">(4.9,</span> <span class="pre">3.1,</span> <span class="pre">1.5,</span> <span class="pre">0.2,</span> <span class="pre">'Iris-setosa')</span></code> and the entire
data set as a list of tuples.</p>
<div class="section" id="basics">
<h2>Basics<a class="headerlink" href="#basics" title="Permalink to this headline">¶</a></h2>
<p><strong>nuts-ml</strong> is designed to read data in an iterative fashion to allow the processing
of arbitrarily large data sets. It largely relies on <strong>nuts-flow</strong>, which is
documented <a class="reference external" href="https://maet3608.github.io/nuts-flow/">here</a>. In the following
a short introduction of the basic principles.</p>
<p>We start by importing <strong>nuts-flow</strong> and <strong>nuts-ml</strong></p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">nutsflow</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">nutsml</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<p>and create a tiny, in-memory example data set:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;odd&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;even&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;odd&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>Data pipelines in <strong>nuts-ml</strong> require a <a class="reference external" href="https://maet3608.github.io/nuts-flow/overview.html">sink</a> that pulls the data. The two most common ones are
<a class="reference external" href="https://maet3608.github.io/nuts-flow/nutsflow.html#nutsflow.sink.Consume">Consume</a> and
<a class="reference external" href="https://maet3608.github.io/nuts-flow/nutsflow.html#nutsflow.sink.Collect">Collect</a> but
there are many <a class="reference external" href="https://maet3608.github.io/nuts-flow/overview.html">others</a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">Consume()</span></code> consumes all data and returns nothing, while <code class="docutils literal notranslate"><span class="pre">Collect()</span></code> collects all data in a list.
As an example we take the first two samples of the data set. Without a sink the pipeline is
not processing anything at all and only the generator (stemming from <code class="docutils literal notranslate"><span class="pre">Take()</span></code>) is returned.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">&gt;&gt;</span> <span class="n">Take</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="go">itertools.islice at 0xbf160e8&gt;</span>
</pre></div>
</div>
<p>Adding a <code class="docutils literal notranslate"><span class="pre">Collect()</span></code> results in the processing of the data and gives us what we want:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">&gt;&gt;</span> <span class="n">Take</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">Collect</span><span class="p">()</span>
<span class="go">[(1, &#39;odd&#39;), (2, &#39;even&#39;)]</span>
</pre></div>
</div>
<p>The same pipeline using <code class="docutils literal notranslate"><span class="pre">Consume()</span></code> returns nothing</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">&gt;&gt;</span> <span class="n">Take</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">Consume</span><span class="p">()</span>
</pre></div>
</div>
<p>but we can verify that samples are processed by inserting a
<a class="reference external" href="https://maet3608.github.io/nuts-flow/nutsflow.html#nutsflow.function.Print">Print</a> nut:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">&gt;&gt;</span> <span class="n">Print</span><span class="p">()</span> <span class="o">&gt;&gt;</span> <span class="n">Take</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">Consume</span><span class="p">()</span>
<span class="go">(1, &#39;odd&#39;)</span>
<span class="go">(2, &#39;even&#39;)</span>
</pre></div>
</div>
<p>A broken pipeline or a pipeline without sink is a common problem that can be debugged
easily by inserting <code class="docutils literal notranslate"><span class="pre">Print()</span></code> functions. Two other very common and important functions are
<a class="reference external" href="https://maet3608.github.io/nuts-flow/nutsflow.html#nutsflow.processor.Filter">Filter</a> and
<a class="reference external" href="https://maet3608.github.io/nuts-flow/nutsflow.html#nutsflow.processor.Map">Map</a>.</p>
<p>As the name indicates, <code class="docutils literal notranslate"><span class="pre">Filter</span></code> is used to filter samples based on a provided
boolean function:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">&gt;&gt;</span> <span class="n">Filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;odd&#39;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">Print</span><span class="p">()</span> <span class="o">&gt;&gt;</span> <span class="n">Consume</span><span class="p">()</span>
<span class="go">(1, &#39;odd&#39;)</span>
<span class="go">(3, &#39;odd&#39;)</span>
</pre></div>
</div>
<p>or maybe more clearly with additional printing</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">is_odd</span><span class="p">(</span><span class="n">sample</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">sample</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;odd&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">&gt;&gt;</span> <span class="n">Print</span><span class="p">(</span><span class="s1">&#39;before: </span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">Filter</span><span class="p">(</span><span class="n">is_odd</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">Print</span><span class="p">(</span><span class="s1">&#39;after : </span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">Consume</span><span class="p">()</span>
<span class="go">before: 1,odd</span>
<span class="go">after : 1,odd</span>
<span class="go">before: 2,even</span>
<span class="go">before: 3,odd</span>
<span class="go">after : 3,odd</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Map</span></code> applies a function to the samples of a data set, e.g.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">add_two</span><span class="p">(</span><span class="n">sample</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">number</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">sample</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">number</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">label</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">&gt;&gt;</span> <span class="n">Map</span><span class="p">(</span><span class="n">add_two</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">Collect</span><span class="p">()</span>
<span class="go">[(3, &#39;odd&#39;), (4, &#39;even&#39;), (5, &#39;odd&#39;)]</span>
</pre></div>
</div>
<p>There is a convenience nut <a class="reference external" href="https://maet3608.github.io/nuts-flow/nutsflow.html#nutsflow.processor.MapCol">MapCol</a>
that maps a function to a specific column (or columns) of a sample. This allows us
to write more succinctly</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">add_two</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">number</span><span class="p">:</span> <span class="n">number</span> <span class="o">+</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">&gt;&gt;</span> <span class="n">MapCol</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">add_two</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">Collect</span><span class="p">()</span>
<span class="go">[(3, &#39;odd&#39;), (4, &#39;even&#39;), (5, &#39;odd&#39;)]</span>
</pre></div>
</div>
<p>For simple expressions a Scala like syntax can be used to further shorten the code:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">&gt;&gt;</span> <span class="n">MapCol</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">_</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">Collect</span><span class="p">()</span>
<span class="go">[(3, &#39;odd&#39;), (4, &#39;even&#39;), (5, &#39;odd&#39;)]</span>
</pre></div>
</div>
<p>Let’s combine what we learned and construct a pipeline that extracts the first number
in the data set that is even and converts the labels to upper case.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">to_upper</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">label</span><span class="p">:</span> <span class="n">label</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">is_even</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">number</span><span class="p">:</span> <span class="n">number</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">first_even</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span> <span class="o">&gt;&gt;</span> <span class="n">FilterCol</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">is_even</span><span class="p">)</span> <span class="o">&gt;&gt;</span>
<span class="gp">... </span><span class="n">MapCol</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">to_upper</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">Take</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">Collect</span><span class="p">())</span>
<span class="go">[(2, &#39;EVEN&#39;)]</span>
</pre></div>
</div>
<p>Here we used <a class="reference external" href="https://maet3608.github.io/nuts-flow/nutsflow.html#nutsflow.processor.FilterCol">FilterCol</a>
instead of <code class="docutils literal notranslate"><span class="pre">Filter</span></code> to filter for the contents in column <code class="docutils literal notranslate"><span class="pre">0</span></code> (the numbers) of
the samples. Note that we wrap the pipeline into brackets allowing it to run over multiple lines.
Alternatively, we could refactor the code as follows to shorten the pipeline:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">to_upper</span> <span class="o">=</span> <span class="n">MapCol</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">label</span><span class="p">:</span> <span class="n">label</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">is_even</span> <span class="o">=</span> <span class="n">FilterCol</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">number</span><span class="p">:</span> <span class="n">number</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">first_even</span> <span class="o">=</span> <span class="n">data</span> <span class="o">&gt;&gt;</span> <span class="n">is_even</span> <span class="o">&gt;&gt;</span> <span class="n">to_upper</span> <span class="o">&gt;&gt;</span> <span class="n">Head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">[(2, &#39;EVEN&#39;)]</span>
</pre></div>
</div>
<p>This concludes the basics. In the following examples we will read data sets
in different formats from the file system and the web.</p>
</div>
<div class="section" id="txt-files">
<h2>TXT files<a class="headerlink" href="#txt-files" title="Permalink to this headline">¶</a></h2>
<p>Let us start with reading data from a simple text file. Here a tiny example file
<code class="docutils literal notranslate"><span class="pre">tests/data/and.txt</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y</span>
<span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">no</span>
<span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">no</span>
<span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">no</span>
<span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">yes</span>
</pre></div>
</div>
<p>We can loads the file content with Python’s <code class="docutils literal notranslate"><span class="pre">open</span></code> function that returns an
iterator over the lines and collect them in a <code class="docutils literal notranslate"><span class="pre">list</span></code></p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">nutsflow</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;tests/data/and.txt&#39;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">Collect</span><span class="p">()</span>
<span class="go">[&#39;x1,x2,y\n&#39;, &#39;0,0,no\n&#39;, &#39;0,1,no\n&#39;, &#39;1,0,no\n&#39;, &#39;1,1,yes&#39;]</span>
</pre></div>
</div>
<p>Of course, <code class="docutils literal notranslate"><span class="pre">open('tests/data/and.txt').readlines()</span></code> would have achieved the same.
However, samples as strings are not very useful. We would like samples to be
represented as tuples or lists containing column values. First, we therefore define a
nut function that strips white spaces from lines and splits a line into
its components:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">split</span> <span class="o">=</span> <span class="n">Map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">line</span> <span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>This as a <code class="docutils literal notranslate"><span class="pre">Map</span></code> because it will be applied to each line of the file.
Let us try it out by reading the header of the file</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">lines</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;tests/data/and.txt&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lines</span> <span class="o">&gt;&gt;</span> <span class="n">split</span> <span class="o">&gt;&gt;</span> <span class="n">Head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">[[&#39;x1&#39;, &#39;x2&#39;, &#39;y&#39;]]</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">Head(n)</span></code> is a sink that collects the first <code class="docutils literal notranslate"><span class="pre">n</span></code> lines in a list (here only one line).
As expected, we get the header with the column names.
Since <code class="docutils literal notranslate"><span class="pre">open</span></code> returns an iterator <code class="docutils literal notranslate"><span class="pre">lines</span></code> is ready to deliver the remaining
lines of the file. For instance, we could now write</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">lines</span> <span class="o">&gt;&gt;</span> <span class="n">split</span> <span class="o">&gt;&gt;</span> <span class="n">Print</span><span class="p">()</span> <span class="o">&gt;&gt;</span> <span class="n">Consume</span><span class="p">()</span>
<span class="go">[&#39;0&#39;, &#39;0&#39;, &#39;no&#39;]</span>
<span class="go">[&#39;0&#39;, &#39;1&#39;, &#39;no&#39;]</span>
<span class="go">[&#39;1&#39;, &#39;0&#39;, &#39;no&#39;]</span>
<span class="go">[&#39;1&#39;, &#39;1&#39;, &#39;yes&#39;]</span>
</pre></div>
</div>
<p>which prints out the samples following the header.
Note that <code class="docutils literal notranslate"><span class="pre">Consume</span></code> does not collect the samples - it just consumes them and
returns nothing. Good for debugging but not suitable for further processing.
We therefore rerun the code and collect the samples in a list. But careful!
The <code class="docutils literal notranslate"><span class="pre">lines</span></code> iterator has been consumed. We have to reopen the file to
restart the iterator:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">lines</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;tests/data/and.txt&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lines</span> <span class="o">&gt;&gt;</span> <span class="n">Drop</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">split</span> <span class="o">&gt;&gt;</span> <span class="n">Collect</span><span class="p">()</span>
<span class="go">[[&#39;0&#39;, &#39;0&#39;, &#39;no&#39;], [&#39;0&#39;, &#39;1&#39;, &#39;no&#39;], [&#39;1&#39;, &#39;0&#39;, &#39;no&#39;], [&#39;1&#39;, &#39;1&#39;, &#39;yes&#39;]]</span>
</pre></div>
</div>
<p>We use <code class="docutils literal notranslate"><span class="pre">Collect</span></code> to collect the samples and <code class="docutils literal notranslate"><span class="pre">Drop(1)</span></code> means that we
skip the header line when reading the file.</p>
<p>Next we need to convert the strings containing numbers to actual numbers.
<code class="docutils literal notranslate"><span class="pre">MapCol</span></code> can be used to map Python’s <code class="docutils literal notranslate"><span class="pre">int</span></code> function on specific columns of the
samples; here columns <code class="docutils literal notranslate"><span class="pre">0</span></code> and  <code class="docutils literal notranslate"><span class="pre">1</span></code> of the samples contain integers:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">lines</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;tests/data/and.txt&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">to_int</span> <span class="o">=</span> <span class="n">MapCol</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">int</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">skip_header</span> <span class="o">=</span> <span class="n">Drop</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">samples</span> <span class="o">=</span> <span class="n">lines</span> <span class="o">&gt;&gt;</span> <span class="n">skip_header</span> <span class="o">&gt;&gt;</span> <span class="n">split</span> <span class="o">&gt;&gt;</span> <span class="n">to_int</span> <span class="o">&gt;&gt;</span> <span class="n">Collect</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>
<span class="go">[(0, 0, &#39;no&#39;), (0, 1, &#39;no&#39;), (1, 0, &#39;no&#39;), (1, 1, &#39;yes&#39;)]</span>
</pre></div>
</div>
<p>Of course we had to reload <code class="docutils literal notranslate"><span class="pre">lines</span></code> again and just for readability gave the
<code class="docutils literal notranslate"><span class="pre">Drop(1)</span></code> function a meaningful name (<code class="docutils literal notranslate"><span class="pre">skip_header</span></code>). We end up with a
nice pipeline that lazily processes individual lines, is modular and
easy to understand: <code class="docutils literal notranslate"><span class="pre">lines</span> <span class="pre">&gt;&gt;</span> <span class="pre">skip_header</span> <span class="pre">&gt;&gt;</span> <span class="pre">split</span> <span class="pre">&gt;&gt;</span> <span class="pre">to_int</span> <span class="pre">&gt;&gt;</span> <span class="pre">Collect()</span></code>
The equivalent Python code without using <strong>nuts-flow/ml</strong> or <code class="docutils literal notranslate"><span class="pre">itertools</span></code> would be</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">split</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">to_int</span><span class="p">(</span><span class="n">sample</span><span class="p">):</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">sample</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x1</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">x2</span><span class="p">),</span> <span class="n">label</span><span class="p">]</span>

<span class="n">lines</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;tests/data/and.txt&#39;</span><span class="p">)</span>
<span class="nb">next</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="n">to_int</span><span class="p">(</span><span class="n">split</span><span class="p">(</span><span class="n">line</span><span class="p">))</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">]</span>
</pre></div>
</div>
<p>If you prefer Python functions but still want to use pipelining, the
functions can be converted into nuts:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nd">@nut_function</span>
<span class="k">def</span> <span class="nf">Split</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>

<span class="nd">@nut_function</span>
<span class="k">def</span> <span class="nf">ToInt</span><span class="p">(</span><span class="n">sample</span><span class="p">):</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">sample</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x1</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">x2</span><span class="p">),</span> <span class="n">label</span><span class="p">]</span>

<span class="n">lines</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;tests/data/and.txt&#39;</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">lines</span> <span class="o">&gt;&gt;</span> <span class="n">Drop</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">Split</span><span class="p">()</span> <span class="o">&gt;&gt;</span> <span class="n">ToInt</span><span class="p">()</span> <span class="o">&gt;&gt;</span> <span class="n">Collect</span><span class="p">()</span>
</pre></div>
</div>
<p>As a final example, we will convert the class labels that are currently strings to
integer numbers – usually needed for training a machine learning classifier.
We could define the following nut and add it to the pipeline:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">label2int</span> <span class="o">=</span> <span class="n">MapCol</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">label</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">label</span><span class="o">==</span><span class="s1">&#39;yes&#39;</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;tests/data/and.txt&#39;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">skip_header</span> <span class="o">&gt;&gt;</span> <span class="n">split</span> <span class="o">&gt;&gt;</span> <span class="n">to_int</span> <span class="o">&gt;&gt;</span> <span class="n">label2int</span> <span class="o">&gt;&gt;</span> <span class="n">Collect</span><span class="p">()</span>
<span class="go">[(0, 0, 0), (0, 1, 0), (1, 0, 0), (1, 1, 1)]</span>
</pre></div>
</div>
<p>However, <strong>nutsml</strong> already has the <a class="reference external" href="https://maet3608.github.io/nuts-ml/nutsml.html#nutsml.common.ConvertLabel">ConvertLabel</a> nut
and we can simply write instead:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">convert</span> <span class="o">=</span> <span class="n">ConvertLabel</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">samples</span> <span class="o">=</span> <span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;tests/data/and.txt&#39;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">skip_header</span> <span class="o">&gt;&gt;</span> <span class="n">split</span> <span class="o">&gt;&gt;</span> <span class="n">to_int</span> <span class="o">&gt;&gt;</span>
<span class="gp">... </span><span class="n">convert</span> <span class="o">&gt;&gt;</span> <span class="n">Print</span><span class="p">()</span> <span class="o">&gt;&gt;</span> <span class="n">Collect</span><span class="p">())</span>
<span class="go">(0, 0, 0)</span>
<span class="go">(0, 1, 0)</span>
<span class="go">(1, 0, 0)</span>
<span class="go">(1, 1, 1)</span>
</pre></div>
</div>
<p>Using <cite>ConvertLabel</cite> has the additional advantage that the conversion back from
integers to strings is trivial:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">samples</span> <span class="o">&gt;&gt;</span> <span class="n">convert</span> <span class="o">&gt;&gt;</span> <span class="n">Print</span><span class="p">()</span> <span class="o">&gt;&gt;</span> <span class="n">Consume</span><span class="p">()</span>
<span class="go">(0, 0, &#39;no&#39;)</span>
<span class="go">(0, 1, &#39;no&#39;)</span>
<span class="go">(1, 0, &#39;no&#39;)</span>
<span class="go">(1, 1, &#39;yes&#39;)</span>
</pre></div>
</div>
<p><cite>ConvertLabel(column, labels)</cite> takes as parameter the column in a sample that contains
the class label (here column 2) and a list of labels. If the class label is a strings it
converts to an integer and vice versa.  <cite>ConvertLabel</cite> can also convert to one-hot-encoded
vectors and back:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">convert</span> <span class="o">=</span> <span class="n">ConvertLabel</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">onehot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">samples</span> <span class="o">=</span> <span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;tests/data/and.txt&#39;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">skip_header</span> <span class="o">&gt;&gt;</span> <span class="n">split</span> <span class="o">&gt;&gt;</span> <span class="n">to_int</span> <span class="o">&gt;&gt;</span>
<span class="gp">... </span><span class="n">convert</span> <span class="o">&gt;&gt;</span> <span class="n">Print</span><span class="p">()</span> <span class="o">&gt;&gt;</span> <span class="n">Collect</span><span class="p">())</span>
<span class="go">(0, 0, [1, 0])</span>
<span class="go">(0, 1, [1, 0])</span>
<span class="go">(1, 0, [1, 0])</span>
<span class="go">(1, 1, [0, 1])</span>
</pre></div>
</div>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">samples</span> <span class="o">&gt;&gt;</span> <span class="n">convert</span> <span class="o">&gt;&gt;</span> <span class="n">Print</span><span class="p">()</span> <span class="o">&gt;&gt;</span> <span class="n">Consume</span><span class="p">()</span>
<span class="go">(0, 0, &#39;no&#39;)</span>
<span class="go">(0, 1, &#39;no&#39;)</span>
<span class="go">(1, 0, &#39;no&#39;)</span>
<span class="go">(1, 1, &#39;yes&#39;)</span>
</pre></div>
</div>
</div>
<div class="section" id="csv-files">
<h2>CSV files<a class="headerlink" href="#csv-files" title="Permalink to this headline">¶</a></h2>
<p>You will have noticed that the <code class="docutils literal notranslate"><span class="pre">tests/data/and.txt</span></code> file used above is actually a
file in CSV (Comma Separated Values) format. Reading of CSV files is so common that
Python has a dedicated <a class="reference external" href="https://docs.python.org/3/library/csv.html">CSV library</a> for it. Similarily,
<strong>nuts-flow</strong> provides a <a class="reference external" href="https://github.com/maet3608/nuts-flow/blob/master/nutsflow/source.py">ReadCSV</a> nut,
and <strong>nuts-ml</strong> has the even more powerful <a class="reference external" href="https://github.com/maet3608/nuts-ml/blob/master/nutsml/reader.py">ReadPandas</a>
nut. For instance, we could write</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">filepath</span> <span class="o">=</span> <span class="s1">&#39;tests/data/and.csv&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">ReadCSV</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">skipheader</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fmtfunc</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">,</span><span class="nb">str</span><span class="p">))</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">samples</span> <span class="o">=</span> <span class="n">reader</span> <span class="o">&gt;&gt;</span> <span class="n">Collect</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>
<span class="go">[(0, 0, &#39;no&#39;), (0, 1, &#39;no&#39;), (1, 0, &#39;no&#39;), (1, 1, &#39;yes&#39;)]</span>
</pre></div>
</div>
<p>which also properly closes the data file – a detail we have neglected before.
The code becomes even simpler with the <code class="docutils literal notranslate"><span class="pre">ReadPandas</span></code> nut but note that this
nut reads all data in memory:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">nutsml</span> <span class="kn">import</span> <span class="n">ReadPandas</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">samples</span> <span class="o">=</span> <span class="n">ReadPandas</span><span class="p">(</span><span class="s1">&#39;tests/data/and.csv&#39;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">Collect</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>
<span class="go">[(0, 0, &#39;no&#39;), (0, 1, &#39;no&#39;), (1, 0, &#39;no&#39;), (1, 1, &#39;yes&#39;)]</span>
</pre></div>
</div>
<p>The advantage is that it drops the header, splits the lines and
converts numbers to integers automatically. <code class="docutils literal notranslate"><span class="pre">ReadPandas</span></code> furthermore
can read TSV (Tab Separated Values) files and other format. Finally,
<code class="docutils literal notranslate"><span class="pre">ReadPandas</span></code> can easily extract or reorder columns or filter rows:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;x1&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ReadPandas</span><span class="p">(</span><span class="s1">&#39;tests/data/and.csv&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">Print</span><span class="p">()</span> <span class="o">&gt;&gt;</span> <span class="n">Consume</span><span class="p">()</span>
<span class="go">(&#39;no&#39;, 0)</span>
<span class="go">(&#39;no&#39;, 0)</span>
<span class="go">(&#39;no&#39;, 1)</span>
<span class="go">(&#39;yes&#39;, 1)</span>
</pre></div>
</div>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rows</span> <span class="o">=</span> <span class="s1">&#39;x1&gt;0&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ReadPandas</span><span class="p">(</span><span class="s1">&#39;tests/data/and.csv&#39;</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">Print</span><span class="p">()</span> <span class="o">&gt;&gt;</span> <span class="n">Consume</span><span class="p">()</span>
<span class="go">(&#39;no&#39;, 1)</span>
<span class="go">(&#39;yes&#39;, 1)</span>
</pre></div>
</div>
</div>
<div class="section" id="numpy-arrays">
<h2>NumPy arrays<a class="headerlink" href="#numpy-arrays" title="Permalink to this headline">¶</a></h2>
<p>To use NumPy arrays as data sources we need to wrap them into an iterator.
In the following example we create an identity matrix, iterate over the rows,
and print them:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">iter</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">Print</span><span class="p">()</span> <span class="o">&gt;&gt;</span> <span class="n">Consume</span><span class="p">()</span>
<span class="go">[1.0, 0.0, 0.0, 0.0]</span>
<span class="go">[0.0, 1.0, 0.0, 0.0]</span>
<span class="go">[0.0, 0.0, 1.0, 0.0]</span>
<span class="go">[0.0, 0.0, 0.0, 1.0]</span>
</pre></div>
</div>
<p>Note that NumPy arrays larger than memory can be loaded and then processed with
<a class="reference external" href="https://docs.scipy.org/doc/numpy-1.14.0/reference/generated/numpy.load.html">np.load(filename, mmap_mode=’r’)</a>.</p>
</div>
<div class="section" id="web-files">
<h2>Web files<a class="headerlink" href="#web-files" title="Permalink to this headline">¶</a></h2>
<p><strong>nuts-flow/ml</strong> allows us to download and process data files from the web on the fly.
Alternatively you can download the file and the process its content as described above.
In the following example, however, we download and process the <a class="reference external" href="https://en.wikipedia.org/wiki/Iris_flower_data_set#Data_set">Iris data set</a>
line by line. First, we open the URL to the data set located on the UCI
machine learning server:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">urllib</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://archive.ics.uci.edu/ml/machine-learning-databases/iris/iris.data&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lines</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span>
</pre></div>
</div>
<p>We now can inspect the first two lines of the data set:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">lines</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">Head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="go">[b&#39;5.1,3.5,1.4,0.2,Iris-setosa\n&#39;,</span>
<span class="go"> b&#39;4.9,3.0,1.4,0.2,Iris-setosa\n&#39;]</span>
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">lines</span></code> is just a renaming of the <code class="docutils literal notranslate"><span class="pre">urllib.request.urlopen</span></code> function and <code class="docutils literal notranslate"><span class="pre">Head(2)</span></code>
collects the first two lines. You will notice that (since Py3K) the lines are in binary (b) format.
The following code convert lines to strings, strips the the newline, and splits at comma
to give as samples with columns:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">to_columns</span> <span class="o">=</span> <span class="n">Map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lines</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">to_columns</span> <span class="o">&gt;&gt;</span> <span class="n">Head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="go">[[&#39;5.1&#39;, &#39;3.5&#39;, &#39;1.4&#39;, &#39;0.2&#39;, &#39;Iris-setosa&#39;],</span>
<span class="go"> [&#39;4.9&#39;, &#39;3.0&#39;, &#39;1.4&#39;, &#39;0.2&#39;, &#39;Iris-setosa&#39;]]</span>
</pre></div>
</div>
<p>The four numeric features in columns 0 to 3 of the samples are still strings but we want floats.
Mapping the <code class="docutils literal notranslate"><span class="pre">float</span></code> function on those columns will do it:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">to_float</span> <span class="o">=</span> <span class="n">MapCol</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lines</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">to_columns</span> <span class="o">&gt;&gt;</span> <span class="n">to_float</span> <span class="o">&gt;&gt;</span> <span class="n">Head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="go">[(5.1, 3.5, 1.4, 0.2, &#39;Iris-setosa&#39;),</span>
<span class="go"> (4.9, 3.0, 1.4, 0.2, &#39;Iris-setosa&#39;)]</span>
</pre></div>
</div>
<p>Finally, we are going to replace the class labels (e.g. <code class="docutils literal notranslate"><span class="pre">'Iris-setosa'</span></code>) by
numeric class indices. We could look the the names of the classes up, but
being lazy we extract them directly via</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">skip_empty</span> <span class="o">=</span> <span class="n">Filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">cols</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">labels</span> <span class="o">=</span> <span class="n">lines</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">to_columns</span> <span class="o">&gt;&gt;</span> <span class="n">skip_empty</span> <span class="o">&gt;&gt;</span> <span class="n">Get</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">Dedupe</span><span class="p">()</span> <span class="o">&gt;&gt;</span> <span class="n">Collect</span><span class="p">()</span>
<span class="go">[&#39;Iris-setosa&#39;, &#39;Iris-versicolor&#39;, &#39;Iris-virginica&#39;]</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">Get(4)</span></code> gets the elements in the fourth column of the sample and <code class="docutils literal notranslate"><span class="pre">Dedupe()</span></code>
removes all duplicate labels. We need <code class="docutils literal notranslate"><span class="pre">skip_empty</span></code>, since the data set contains an
empty line at the end.</p>
<p>We now can use the extracted <code class="docutils literal notranslate"><span class="pre">labels</span></code> and the <code class="docutils literal notranslate"><span class="pre">ConvertLabel</span></code> nut to convert
the class labels in column 4 from strings to class indices. For showcasing, we
download the entire data set put print only every 20-th sample.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">lines</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">to_columns</span> <span class="o">&gt;&gt;</span> <span class="n">skip_empty</span> <span class="o">&gt;&gt;</span> <span class="n">to_float</span> <span class="o">&gt;&gt;</span>
<span class="gp">... </span> <span class="n">ConvertLabel</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">Print</span><span class="p">(</span><span class="n">every_n</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">Consume</span><span class="p">())</span>
<span class="go">(5.1, 3.8, 1.5, 0.3, 0)</span>
<span class="go">(5.1, 3.4, 1.5, 0.2, 0)</span>
<span class="go">(5.2, 2.7, 3.9, 1.4, 1)</span>
<span class="go">(5.7, 2.6, 3.5, 1.0, 1)</span>
<span class="go">(5.7, 2.8, 4.1, 1.3, 1)</span>
<span class="go">(6.0, 2.2, 5.0, 1.5, 2)</span>
<span class="go">(6.9, 3.1, 5.4, 2.1, 2)</span>
</pre></div>
</div>
</div>
<div class="section" id="label-directories">
<h2>Label directories<a class="headerlink" href="#label-directories" title="Permalink to this headline">¶</a></h2>
<p>A common method to organize data and assign labels to large data objects such as
text files, audio recordings or images is to create directories with labels as names
and to store the data objects in the corresponding directories.</p>
<p>For an example let us assume two classes (<code class="docutils literal notranslate"><span class="pre">0</span></code> and <code class="docutils literal notranslate"><span class="pre">1</span></code>) and three text files
that are arranged in the following file structure</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">books</span>
  <span class="o">-</span> <span class="mi">0</span>
    <span class="o">-</span> <span class="n">text0</span><span class="o">.</span><span class="n">txt</span>
  <span class="o">-</span> <span class="mi">1</span>
    <span class="o">-</span> <span class="n">text1</span><span class="o">.</span><span class="n">txt</span>
    <span class="o">-</span> <span class="n">text11</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p><strong>nuts-ml</strong> supports the reading of such file structures via the <a class="reference external" href="https://maet3608.github.io/nuts-ml/nutsml.html#module-nutsml.reader">ReadLabelDirs()</a> nut. The
following code demonstrates its usage:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">samples</span> <span class="o">=</span> <span class="n">ReadLabelDirs</span><span class="p">(</span><span class="s1">&#39;books&#39;</span><span class="p">,</span> <span class="s1">&#39;*.txt&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">samples</span> <span class="o">&gt;&gt;</span> <span class="n">Take</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">Print</span><span class="p">()</span> <span class="o">&gt;&gt;</span> <span class="n">Consume</span><span class="p">()</span>
<span class="go">(&#39;books/0/text0.txt&#39;, &#39;0&#39;)</span>
<span class="go">(&#39;books/1/text1.txt&#39;, &#39;1&#39;)</span>
<span class="go">(&#39;books/1/text11.txt&#39;, &#39;1&#39;)</span>
</pre></div>
</div>
<p>Note that this code does not load the actual text data but the file paths only.
However, we could easily implement a <code class="docutils literal notranslate"><span class="pre">Process</span></code> nut that loads and processes
the text files individually without loading all texts in memory at once.
For instance, converting text files into word count dictionaries.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nd">@nut_function</span>
<span class="k">def</span> <span class="nf">Process</span><span class="p">(</span><span class="n">sample</span><span class="p">):</span>
    <span class="n">filepath</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">sample</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
      <span class="n">counts</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">CountValues</span><span class="p">()</span>
      <span class="k">return</span> <span class="n">counts</span><span class="p">,</span> <span class="n">labels</span>

<span class="n">samples</span> <span class="o">=</span> <span class="n">ReadLabelDirs</span><span class="p">(</span><span class="s1">&#39;books&#39;</span><span class="p">,</span> <span class="s1">&#39;*.txt&#39;</span><span class="p">)</span>
<span class="n">word_counts</span> <span class="o">=</span> <span class="n">samples</span> <span class="o">&gt;&gt;</span> <span class="n">Process</span><span class="p">()</span> <span class="o">&gt;&gt;</span> <span class="n">Collect</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="split_stratify.html" class="btn btn-neutral float-right" title="Splitting and stratifying" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="introduction.html" class="btn btn-neutral float-left" title="Tutorial" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, IBM Research Australia
      <span class="lastupdated">
        Last updated on Nov 16, 2020.
      </span>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>